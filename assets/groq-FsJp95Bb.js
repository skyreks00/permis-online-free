const g="0.37.0";let T=!1,R,V,J,v,K,Q,Y,z,Z;function _e(r,e={auto:!1}){if(T)throw new Error(`you must \`import 'groq-sdk/shims/${r.kind}'\` before importing anything else from groq-sdk`);if(R)throw new Error(`can't \`import 'groq-sdk/shims/${r.kind}'\` after \`import 'groq-sdk/shims/${R}'\``);T=e.auto,R=r.kind,V=r.fetch,J=r.FormData,v=r.File,K=r.ReadableStream,Q=r.getMultipartRequestOptions,Y=r.getDefaultAgent,z=r.fileFromPath,Z=r.isFsReadStream}class Pe{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Oe({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import … from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n";let t,n,s,o;try{t=fetch,n=Request,s=Response,o=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,a)=>({...a,body:new Pe(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:i=>!1}}const ee=()=>{R||_e(Oe(),{auto:!0})};ee();class p extends Error{}class f extends p{constructor(e,t,n,s){super(`${f.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){const s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new k({message:n,cause:L(t)});const o=t;return e===400?new re(e,o,n,s):e===401?new ne(e,o,n,s):e===403?new se(e,o,n,s):e===404?new oe(e,o,n,s):e===409?new ie(e,o,n,s):e===422?new ae(e,o,n,s):e===429?new ue(e,o,n,s):e>=500?new ce(e,o,n,s):new f(e,o,n,s)}}class B extends f{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class k extends f{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class te extends k{constructor({message:e}={}){super({message:e??"Request timed out."})}}class re extends f{}class ne extends f{}class se extends f{}class oe extends f{}class ie extends f{}class ae extends f{}class ue extends f{}class ce extends f{}class b{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;const s=new $e;async function*o(){if(!e.body)throw t.abort(),new p("Attempted to iterate over a response with no body");const a=new w,c=U(e.body);for await(const u of c)for(const d of a.decode(u)){const y=s.decode(d);y&&(yield y)}for(const u of a.flush()){const d=s.decode(u);d&&(yield d)}}async function*i(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const c of o())if(!a){if(c.data.startsWith("[DONE]")){a=!0;continue}if(c.event===null||c.event==="error"){let u;try{u=JSON.parse(c.data)}catch(d){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),d}if(u&&u.error)throw new f(u.error.status_code,u.error,u.error.message,void 0);yield u}}a=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{a||t.abort()}}return new b(i,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new w,a=U(e);for await(const c of a)for(const u of i.decode(c))yield u;for(const c of i.flush())yield c}async function*o(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const a of s())i||a&&(yield JSON.parse(a));i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new b(o,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=o=>({next:()=>{if(o.length===0){const i=n.next();e.push(i),t.push(i)}return o.shift()}});return[new b(()=>s(e),this.controller),new b(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new K({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:o,done:i}=await t.next();if(i)return s.close();const a=n.encode(JSON.stringify(o)+`
`);s.enqueue(a)}catch(o){s.error(o)}},async cancel(){await t.return?.()}})}}class $e{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=Ce(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}class w{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=w.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(w.NEWLINE_REGEXP);return s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new p(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new p(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new p("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}w.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","","\u2028","\u2029"]);w.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Ce(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function U(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const le=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",fe=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&_(r),_=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",ve=r=>fe(r)||le(r)||Z(r);async function de(r,e,t){if(r=await r,fe(r))return r;if(le(r)){const s=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=_(s)?[await s.arrayBuffer()]:[s];return new v(o,e,t)}const n=await Be(r);if(e||(e=Le(r)??"unknown_file"),!t?.type){const s=n[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new v(n,e,t)}async function Be(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(_(r))e.push(await r.arrayBuffer());else if(Ne(r))for await(const t of r)e.push(t);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${r?.constructor?.name}; props: ${Ie(r)}`);return e}function Ie(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Le(r){return $(r.name)||$(r.filename)||$(r.path)?.split(/[\\/]/).pop()}const $=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Ne=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",j=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",N=async r=>{const e=await De(r.body);return Q(e,r)},De=async r=>{const e=new J;return await Promise.all(Object.entries(r||{}).map(([t,n])=>I(e,t,n))),e},I=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(ve(t)){const n=await de(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>I(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>I(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var pe={},Fe=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},Te=function(r,e,t,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)},q;ee();async function he(r){const{response:e}=r;if(r.options.stream)return x("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):b.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const n=e.headers.get("content-type")?.split(";")[0]?.trim();if(n?.includes("application/json")||n?.endsWith("+json")){const i=await e.json();return x("response",e.status,e.url,e.headers,i),i}const o=await e.text();return x("response",e.status,e.url,e.headers,o),o}class P extends Promise{constructor(e,t=he){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new P(this.responsePromise,async t=>e(await this.parseResponse(t),t))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Ue{constructor({baseURL:e,baseURLOverridden:t,maxRetries:n=2,timeout:s=6e4,httpAgent:o,fetch:i}){q.set(this,void 0),this.baseURL=e,Fe(this,q,t),this.maxRetries=C("maxRetries",n),this.timeout=C("timeout",s),this.httpAgent=o,this.fetch=i??V}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json",...["head","get"].includes(e.method)?{}:{"Content-Type":"application/json"},"User-Agent":this.getUserAgent(),...We(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ze()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const o=s&&_(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:o}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:s,path:o,query:i,defaultBaseURL:a,headers:c={}}=n,u=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:j(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,d=this.calculateContentLength(u),y=this.buildURL(o,i,a);"timeout"in n&&C("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const m=n.httpAgent??this.httpAgent??Y(y),S=n.timeout+1e3;typeof m?.options?.timeout=="number"&&S>(m.options.timeout??0)&&(m.options.timeout=S),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),c[this.idempotencyHeader]=e.idempotencyKey);const F=this.buildHeaders({options:n,headers:c,contentLength:d,retryCount:t});return{req:{method:s,...u&&{body:u},headers:F,...m&&{agent:m},signal:n.signal??null},url:y,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const o={};n&&(o["content-length"]=n);const i=this.defaultHeaders(e);return G(o,i),G(o,t),j(e.body)&&R!=="node"&&delete o["content-type"],A(i,"x-stainless-retry-count")===void 0&&A(t,"x-stainless-retry-count")===void 0&&(o["x-stainless-retry-count"]=String(s)),A(i,"x-stainless-timeout")===void 0&&A(t,"x-stainless-timeout")===void 0&&e.timeout&&(o["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(o,t),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return f.generate(e,t,n,s)}request(e,t=null){return new P(this.makeRequest(e,t))}async makeRequest(e,t){const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:o,url:i,timeout:a}=await this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(o,{url:i,options:n}),x("request",i,n,o.headers),n.signal?.aborted)throw new B;const c=new AbortController,u=await this.fetchWithTimeout(i,o,a,c).catch(L);if(u instanceof Error){if(n.signal?.aborted)throw new B;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new te:new k({cause:u})}const d=Me(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const O=`retrying, ${t} attempts remaining`;return x(`response (error; ${O})`,u.status,i,d),this.retryRequest(n,t,d)}const y=await u.text().catch(O=>L(O).message),m=Ge(y),S=m?void 0:y;throw x(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,d,S),this.makeStatusError(u.status,m,S,d)}return{response:u,options:n,controller:c}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new je(this,n,e)}buildURL(e,t,n){const s=!Te(this,q)&&n||this.baseURL,o=Je(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Qe(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new p(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:o,...i}=t||{};o&&o.addEventListener("abort",()=>s.abort());const a=setTimeout(()=>s.abort(),n),c={signal:s.signal,...i};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(a)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const o=n?.["retry-after-ms"];if(o){const a=parseFloat(o);Number.isNaN(a)||(s=a)}const i=n?.["retry-after"];if(i&&!s){const a=parseFloat(i);Number.isNaN(a)?s=Date.parse(i)-Date.now():s=a*1e3}if(!(s&&0<=s&&s<60*1e3)){const a=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,a)}return await Ke(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const o=t-e,i=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return i*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${g}`}}q=new WeakMap;class je extends P{constructor(e,t,n){super(t,async s=>new n(e,s.response,await he(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Me=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),He=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":g,"X-Stainless-OS":H(Deno.build.os),"X-Stainless-Arch":M(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":g,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":g,"X-Stainless-OS":H(process.platform),"X-Stainless-Arch":M(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=Xe();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":g,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":g,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Xe(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,o=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${o}.${i}`}}}return null}const M=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",H=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let X;const We=()=>X??(X=He()),Ge=r=>{try{return JSON.parse(r)}catch{return}},Ve=/^[a-z][a-z0-9+.-]*:/i,Je=r=>Ve.test(r),Ke=r=>new Promise(e=>setTimeout(e,r)),C=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new p(`${r} must be an integer`);if(e<0)throw new p(`${r} must be a positive integer`);return e},L=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},W=r=>{if(typeof process<"u")return pe?.[r]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(r)?.trim()};function Qe(r){if(!r)return!0;for(const e in r)return!1;return!0}function Ye(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function G(r,e){for(const t in e){if(!Ye(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function x(r,...e){typeof process<"u"&&pe?.DEBUG==="true"&&console.log(`Groq:DEBUG:${r}`,...e)}const ze=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),Ze=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",et=r=>typeof r?.get=="function",A=(r,e)=>{const t=e.toLowerCase();if(et(r)){const n=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,o,i)=>o+i.toUpperCase());for(const s of[e,t,e.toUpperCase(),n]){const o=r.get(s);if(o)return o}}for(const[n,s]of Object.entries(r))if(n.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};class h{constructor(e){this._client=e}}class ye extends h{create(e,t){return this._client.post("/openai/v1/audio/speech",{body:e,...t,headers:{Accept:"audio/wav",...t?.headers},__binaryResponse:!0})}}class me extends h{create(e,t){return this._client.post("/openai/v1/audio/transcriptions",N({body:e,...t}))}}class we extends h{create(e,t){return this._client.post("/openai/v1/audio/translations",N({body:e,...t}))}}class E extends h{constructor(){super(...arguments),this.speech=new ye(this._client),this.transcriptions=new me(this._client),this.translations=new we(this._client)}}E.Speech=ye;E.Transcriptions=me;E.Translations=we;class ge extends h{create(e,t){return this._client.post("/openai/v1/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/openai/v1/batches/${e}`,t)}list(e){return this._client.get("/openai/v1/batches",e)}cancel(e,t){return this._client.post(`/openai/v1/batches/${e}/cancel`,t)}}let be=class extends h{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}};class D extends h{constructor(){super(...arguments),this.completions=new be(this._client)}}D.Completions=be;class xe extends h{}class Se extends h{create(e,t){return this._client.post("/openai/v1/embeddings",{body:e,...t})}}class Re extends h{create(e,t){return this._client.post("/openai/v1/files",N({body:e,...t}))}list(e){return this._client.get("/openai/v1/files",e)}delete(e,t){return this._client.delete(`/openai/v1/files/${e}`,t)}content(e,t){return this._client.get(`/openai/v1/files/${e}/content`,{...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}info(e,t){return this._client.get(`/openai/v1/files/${e}`,t)}}class Ee extends h{retrieve(e,t){return this._client.get(`/openai/v1/models/${e}`,t)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,t){return this._client.delete(`/openai/v1/models/${e}`,t)}}var Ae,qe;class l extends Ue{constructor({baseURL:e=W("GROQ_BASE_URL"),apiKey:t=W("GROQ_API_KEY"),...n}={}){if(t===void 0)throw new p("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");const s={apiKey:t,...n,baseURL:e||"https://api.groq.com"};if(!s.dangerouslyAllowBrowser&&Ze())throw new p(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Groq({ apiKey, dangerouslyAllowBrowser: true })`);super({baseURL:s.baseURL,baseURLOverridden:e?e!=="https://api.groq.com":!1,timeout:s.timeout??6e4,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),Ae.add(this),this.completions=new xe(this),this.chat=new D(this),this.embeddings=new Se(this),this.audio=new E(this),this.models=new Ee(this),this.batches=new ge(this),this.files=new Re(this),this._options=s,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}qe=l,Ae=new WeakSet;l.Groq=qe;l.DEFAULT_TIMEOUT=6e4;l.GroqError=p;l.APIError=f;l.APIConnectionError=k;l.APIConnectionTimeoutError=te;l.APIUserAbortError=B;l.NotFoundError=oe;l.ConflictError=ie;l.RateLimitError=ue;l.BadRequestError=re;l.AuthenticationError=ne;l.InternalServerError=ce;l.PermissionDeniedError=se;l.UnprocessableEntityError=ae;l.toFile=de;l.fileFromPath=z;l.Completions=xe;l.Chat=D;l.Embeddings=Se;l.Audio=E;l.Models=Ee;l.Batches=ge;l.Files=Re;const it=async(r,e)=>{const t=new l({apiKey:e,dangerouslyAllowBrowser:!0}),n=`
    You are an expert specific to driving license questions.
    Your task is to FIX the following JSON question object.
    
    RULES:
    1. **Fix Typos & Grammar**: Correct any spelling or grammatical errors in 'question', 'propositions', and 'explanation'.
    2. **Start** with a valid JSON structure.
    3. **Three Supported Question Types**:
       - "multiple_choice" (Standard question with options A, B, C... used for BOTH single and multiple valid answers)
       - "true_false" (Binary question, Oui/Non)
       - "number" (Open numeric field, NO propositions)
       
       *CRITICAL RULES FOR TYPES:*
       - If the question has options/propositions (A, B, C), the type MUST be "multiple_choice".
       - NEVER use "single_choice" (it does not exist in the system).
       - NEVER use "number" type if there are possibilities/propositions.
       - ONLY use "number" type if the user must type a value and 'correctAnswer' is a raw number (e.g. "50", "0.5").
    4. **Propositions Structure**:
       - Must be an array of objects: [{ "letter": "A", "text": "..." }, { "letter": "B", "text": "..." }]
       - Do NOT merge propositions into the question text.
       - Ensure "answer" field matches the letters (e.g., "A" or "AC").
    5. **JSON Only**: Output ONLY valid JSON, no markdown formatting (no \`\`\`json).

    Original Question to Fix:
    ${JSON.stringify(r,null,2)}
  `;try{const o=(await t.chat.completions.create({messages:[{role:"user",content:n}],model:"meta-llama/llama-4-scout-17b-16e-instruct",temperature:.2,max_completion_tokens:1024,top_p:1,stream:!1,response_format:{type:"json_object"}})).choices[0]?.message?.content||"{}";console.log("Groq Raw Response:",o);const i=o.replace(/```json/g,"").replace(/```/g,"").trim(),a=JSON.parse(i);return Array.isArray(a)?a[0]:a.question&&a.question.id&&a.question.type?a.type?a:a.question:a}catch(s){throw console.error("Groq API Error:",s),new Error("Impossible de corriger la question avec Groq : "+s.message)}};export{it as fixQuestionWithGroq};
